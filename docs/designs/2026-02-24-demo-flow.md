# Design: Investor Demo Flow — "Maria's Story"

**Feature ID:** `demo-flow`
**Date:** 2026-02-24
**Type:** Feature (demo experience)
**Approach:** Patient story narration with live product demo (Approach C)

## Problem

AuthScript needs a 60–90 second live demo for an investor/judge audience. The product works end-to-end (detect → analyze → review → submit) except the final upload-to-Athena step (mocked). There is no access to the athenahealth frontend EHR, so the integration point cannot be shown natively.

## Constraints

- **Time:** 60–90 seconds, hard cap
- **Audience:** Investors/judges at a pitch competition
- **Environment:** Live demo against Athena sandbox + local services
- **Missing:** No athenahealth frontend access; upload-to-EHR is mocked
- **Working:** Dashboard queue, AI processing via Intelligence service, confidence scoring, criteria assessment, PDF generation, submission animation

## Solution Overview

A two-phase approach:

| Phase | Scope | Deliverable |
|-------|-------|-------------|
| **Phase 1** | Polish the existing dashboard demo flow | Reliable 90-second script with demo reset tooling |
| **Phase 2** | Build lightweight EHR stub | Mock athenaOne patient chart with embedded AuthScript |

---

## Phase 1: Core Demo Flow

### Demo Script — "Maria's Story" (90 seconds)

The presenter narrates while clicking through the live dashboard. Timing targets in brackets.

#### Beat 1: The Problem [0:00–0:15]

**Screen:** Dashboard is open. Queue shows 4-5 existing PAs at various stages.

**Narration:**
> "Every time a doctor orders an MRI or a specialty medication, they need insurance approval first. That's called a prior authorization. Right now, it takes a practice 45 minutes of staff time per request — pulling chart data, matching payer criteria, filling forms. We automate that."

**Actions:** None — the dashboard establishes credibility (real product, real data).

#### Beat 2: The Patient [0:15–0:30]

**Screen:** Presenter clicks "New PA Request" button. NewPAModal opens.

**Narration:**
> "Meet Maria. She's been dealing with chronic back pain for months. Her doctor just examined her and determined she needs a lumbar MRI. Normally, his staff would start a 45-minute paperwork process. With AuthScript..."

**Actions:**
1. Click "New PA Request" → modal opens [2s]
2. Type patient name, select from dropdown [3s]
3. Select "MRI Lumbar Spine (72148)" as procedure [3s]
4. Click "Confirm" [1s]

*Pre-demo prep: Patient name and procedure should be rehearsed for fast selection.*

#### Beat 3: The AI Magic [0:30–0:45]

**Screen:** Processing animation plays — 4 steps with icons:
1. "Reading clinical notes..."
2. "AI analyzing medical necessity..."
3. "Mapping to payer requirements..."
4. "Generating PA form..."

**Narration:**
> "The AI reads Maria's clinical notes, extracts the relevant evidence, evaluates it against her specific payer's requirements, and generates a complete PA form — all in seconds."

**Actions:** None — let the animation run. Narrate over it. Processing takes ~5–15 seconds depending on Intelligence API latency.

#### Beat 4: The Evidence [0:45–1:05]

**Screen:** Click "Review PA Request" → analysis detail page loads. Confidence ring, criteria list, clinical summary visible.

**Narration:**
> "Maria's PA scores 88% confidence. The AI evaluated 5 payer criteria — all met. This isn't a black box. The doctor sees exactly what evidence was found and why each criterion passed."

**Actions:**
1. Success screen → click "Review PA Request" [2s]
2. Let analysis page load — point out confidence ring [3s]
3. Point out criteria list (green checks) [3s]
4. Click one criterion to show reasoning modal [4s]
5. Close modal [1s]
6. Scroll to clinical summary — point out "AI auto-filled" badge [3s]

#### Beat 5: The Resolution [1:05–1:20]

**Screen:** Click "Confirm & Submit". Submission overlay animates.

**Narration:**
> "One click to submit. The completed PA is sent directly to the payer."

**Actions:**
1. Click "Confirm & Submit" [1s]
2. Submission animation plays (~5s) — "Locating submission method..." → "Found UHC ePA"
3. Success modal appears — checkmark [2s]
4. Click "Back to Dashboard" [1s]

#### Beat 6: The Impact [1:20–1:30]

**Screen:** Dashboard with updated stats.

**Narration:**
> "What just took us 90 seconds normally takes 45 minutes. That's $20–30 saved per request, hundreds of requests per practice per month, and patients who get care faster."

**Actions:** None — let the dashboard reinforce the message.

---

### What Needs to Be Built (Phase 1)

#### 1. Demo Reset Script

**Purpose:** Restore the database to a known-good state before each demo run.

**Implementation:** A shell script (`scripts/demo-reset.sh`) that:
- Drops and re-creates the gateway database
- Triggers migration + seed via gateway restart
- Optionally warms up the Intelligence service with a throwaway request

**Why:** After each demo, the submitted PA changes state. Resetting ensures a clean queue every time.

#### 2. Demo-Optimized Patient Scenario

**Purpose:** Guarantee the Intelligence API returns a high-confidence, all-criteria-met result for the demo patient/procedure combo.

**Implementation:** Seed a specific Athena sandbox patient with clinical data (conditions, observations) that maps well to MRI Lumbar Spine criteria. Verify the Intelligence service produces a result with:
- Confidence ≥ 85%
- All criteria marked "met"
- Meaningful clinical summary

**Approach:** Test each sandbox patient (60178–60184) with procedure 72148 against the Intelligence API. Pick the one that produces the best result. If none are reliable enough, add a demo-mode response in the Intelligence service that returns a canned high-quality result for a specific patient+procedure combo.

#### 3. Demo Timing Polish

**Purpose:** Ensure the processing animation feels right for the narrative.

**Changes:**
- If Intelligence API responds faster than the animation minimum (5.2s), the animation already pads it — no change needed
- If Intelligence API is slow (>15s), add a demo-mode flag (`?demo=true` query param) that returns a cached result instantly so the animation isn't awkwardly long
- Verify the 5-second submission animation duration feels right in the narration context

#### 4. NewPAModal Quick-Select (nice-to-have)

**Purpose:** Reduce clicks during Beat 2.

**Implementation:** Add a `?quickDemo=true` URL parameter that pre-fills the NewPAModal with:
- Patient: the demo patient
- Procedure: MRI Lumbar Spine (72148)
- Skips to the "confirm" step

This turns 4 clicks into 1 click (just "Confirm"). Useful if demo time is tight.

---

## Phase 2: EHR Stub

### Concept

A single-page mock athenaOne patient chart that:
1. Shows a patient header (name, DOB, MRN) in athenaOne styling
2. Displays a simplified encounter note
3. Has a "Sign Encounter" button
4. Opens AuthScript as an embedded iframe (per the athenahealth Embedded Apps spec)

### Screen Flow

```
┌─────────────────────────────────────────────────────┐
│  athenaOne  │ Charts │ Schedule │ Messages │         │
├─────────────────────────────────────────────────────┤
│  Maria Garcia  DOB: 03/15/1981  MRN: 60182          │
│  ─────────────────────────────────────────────       │
│  Encounter: 02/24/2026  Provider: Dr. Sarah Chen     │
│                                                       │
│  CC: Chronic lower back pain, 6 months               │
│  HPI: 45yo F presents with persistent lumbar pain...  │
│  Assessment: Lumbar radiculopathy                     │
│  Plan: Order MRI lumbar spine w/o contrast            │
│                                                       │
│  ┌──────────────────┐                                │
│  │  Sign Encounter   │  ← triggers the pipeline      │
│  └──────────────────┘                                │
│                                                       │
│  ┌─ AuthScript (Embedded App) ─────────────────────┐ │
│  │                                                   │ │
│  │  [AuthScript dashboard appears here as iframe]    │ │
│  │                                                   │ │
│  └───────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────┘
```

### What to Build (Phase 2)

#### 1. Mock EHR Page

**Route:** `/ehr-demo` in the dashboard app (or a separate static page)

**Components:**
- `EhrShell` — athenaOne-like chrome (nav bar, patient header)
- `EncounterNote` — Hardcoded clinical note for the demo patient
- `SignButton` — Triggers PA creation via the existing `CreatePARequest` + `ProcessPARequest` mutations
- `EmbeddedAppFrame` — iframe pointing to the AuthScript dashboard

**Styling:** Approximate athenaOne look — blue header, left nav, card-based encounter sections. Doesn't need to be pixel-perfect, just recognizable as "an EHR."

#### 2. Sign → Process Pipeline

When "Sign Encounter" is clicked:
1. Call `CreatePARequest` with pre-configured patient + procedure
2. Call `ProcessPARequest` with the new transaction ID
3. Dashboard (in iframe) auto-refreshes via its 5-second polling and shows the new PA card
4. Presenter clicks into the PA from within the iframe

#### 3. Updated Demo Script (Phase 2)

Beats 1–2 change:

> **Beat 1 [0:00–0:10]:** Screen shows mock EHR with Maria's encounter note. "Maria's doctor just finished her exam. She needs a lumbar MRI. He signs the encounter..."

> **Beat 2 [0:10–0:20]:** Click "Sign Encounter". AuthScript panel appears below. "AuthScript detects the signature instantly and starts processing."

Beats 3–6 remain the same but happen inside the embedded iframe.

---

## Architecture

```
Phase 1 (no EHR stub):
  Browser → Dashboard (React) → Gateway (GraphQL) → Intelligence (FastAPI)
                                     ↓
                              Athena FHIR Sandbox

Phase 2 (with EHR stub):
  Browser → EHR Stub Page
               ├── Mock encounter UI (static)
               └── <iframe src="/dashboard">
                      └── Dashboard → Gateway → Intelligence
                                        ↓
                                 Athena FHIR Sandbox
```

## Risks & Mitigations

| Risk | Impact | Mitigation |
|------|--------|------------|
| Intelligence API slow/down | Processing hangs during demo | Demo-mode cached response (`?demo=true`) |
| Athena sandbox unreachable | FHIR data fetch fails | Cache FHIR responses locally for demo patient |
| Confidence score too low | Story falls flat | Pre-test patient/procedure; demo-mode fallback |
| Audience Wi-Fi issues | API calls fail | Run all services locally; no external dependency except Athena (cacheable) |
| Presenter fumbles patient selection | Wastes 10+ seconds | Quick-select mode (`?quickDemo=true`) |

## Success Criteria

- [ ] Demo completes in 60–90 seconds reliably across 3+ consecutive runs
- [ ] Processing returns ≥85% confidence with all criteria met for demo scenario
- [ ] Demo reset restores clean state in <30 seconds
- [ ] No visible errors, spinners, or broken states during the flow
- [ ] Phase 2: EHR stub loads in <2 seconds, iframe embeds dashboard correctly

## Task Breakdown (Estimated)

### Phase 1
| Task | Scope |
|------|-------|
| Demo reset script | New `scripts/demo-reset.sh` |
| Validate demo patient/procedure combo | Test 60178–60184 × 72148 against Intelligence |
| Demo-mode cached response (if needed) | Intelligence service: return canned result for demo flag |
| Quick-select URL param (nice-to-have) | Dashboard: `NewPAModal` pre-fill logic |
| Rehearsal + timing validation | Run 5+ full demos, adjust narration |

### Phase 2
| Task | Scope |
|------|-------|
| EHR shell component | New `EhrDemoPage` route + components |
| Mock encounter note | Hardcoded clinical note matching demo patient |
| Sign → Process trigger | Wire "Sign Encounter" to GraphQL mutations |
| Embedded iframe integration | iframe with CSP headers per Athena spec |
| Updated demo script | Revised narration for Beats 1–2 |
